
* Fixture: Recollect

| set | email_address | test+%%start_time%%@recollect.net |

# Open the reminder lightbox
| open-reminder-lightbox-ok | vancouver-south-red |

# SMS is the default selected value
| is-checked-ok | sms-reminder |

##
# Calendar Links
#

# Check the google calendar link
| attribute-is | cal-google@href | http://www.google.com/calendar/render?cid=%%browser_url%%/zones/vancouver-south-red/pickupdays.ics |

# Check the outlook calendar link
| set | ics | %%browser_url%%/zones/vancouver-south-red/pickupdays.ics |
| attribute-is | cal-outlook@href | %%ics%% |

# Check the ical calendar link
| set-scheme   | ics           | webcal:// |
| attribute-is | cal-ical@href | %%ics%%   |

# try to confirm an unknown reminder
| open-ok                  | %%browser_url%%/zones/vancouver-south-red/reminders/abracadabra/confirm |
| wait-for-text-present-ok | Sorry, we could not find a valid reminder at this address.              |
| is-text-present-ok       | Please contact help@recollect.net if you think there was a problem.       |

##
# Premium Services

# We need to be logged in to paypal for the test accounts to work - this is silly IMO, since the test accounts are well authenticated... meh
| login-paypal-dev-ok |

##
# Voice Reminders
#

# Open the reminder lightbox
| open-reminder-lightbox-ok | vancouver-south-red |

# Choose phone
| click-ok                 | phone-reminder                      |
| click-ok                 | css=.ui-dialog-buttonset .next      |
| wait-for-text-present-ok | Schedule a Telephone Call Reminder: |

# Email validation
| type-ok                     | css=#premium_phone .phone | 604-800-9811 |
| validate-and-enter-email-ok | css=#premium_phone .email |              |

# Phone number validation
| type-ok                     | css=#premium_phone .email | %%email_address%% |
| validate-and-enter-phone-ok | css=#premium_phone .phone |                   |

| type-ok   | css=#premium_phone .email         | %%email_address%% |
| type-ok   | css=#premium_phone .phone         | 000-000-0000      |
| select-ok | css=#premium_phone .paymentPeriod | $15.00 / Year        |
| click-ok  | css=.ui-dialog-buttonset .submit  |                   |

# Redirect to PayPal
| wait-for-page-to-load-ok | 30000                                      |
| login-paypal-ok          |                                            |
| wait-for-text-present-ok | $15.00 per year for Recollect notifications |

########################################################
| *comment* | CANCEL, go back and choose $1.50 / Month |

| open-reminder-lightbox-ok | vancouver-south-red                        |                   |
| click-ok                  | phone-reminder                             |                   |
| click-ok                  | css=.ui-dialog-buttonset .next             |                   |
| wait-for-text-present-ok  | Schedule a Telephone Call Reminder:        |                   |
| type-ok                   | css=#premium_phone .email                  | %%email_address%% |
| type-ok                   | css=#premium_phone .phone                  | 000-000-0000      |
| select-ok                 | css=#premium_phone .paymentPeriod          | $1.50 / Month     |
| click-ok                  | css=.ui-dialog-buttonset .submit           |                   |
| wait-for-page-to-load-ok  | 30000                                      |                   |
| login-paypal-ok           |                                            |                   |
| wait-for-text-present-ok  | $1.50 per month for Recollect notifications |                   |

| click-ok                 | continue                                                   |
| wait-for-text-present-ok | Thank you for subscribing to Recollect, %%email_address%%.  |
| is-text-present-ok       | You will soon receive a confirmation email and phone call. |

# Wait for the welcome email 
| reminder-success-email-ok | %%email_address%% | phone |

# Remove the reminder
| open-ok                     | %%delete_url%%                                                                              |
| click-ok                    | css=.button.yes                                                                             |
| wait-for-text-present-ok    | The following garbage reminder has been deleted:                                            |
| is-text-present-ok          | Zone:vancouver-south-red                                                                    |
| is-text-present-ok          | Email:%%email_address%%                                                                     |

##
# SMS Reminders
#

# Open the reminder lightbox
| open-reminder-lightbox-ok | vancouver-south-red |

# Choose sms
| click-ok                 | sms-reminder                      |
| click-ok                 | css=.ui-dialog-buttonset .next    |
| wait-for-text-present-ok | Schedule a Text Message Reminder: |

# Email validation
| type-ok                     | css=#premium_sms .phone | 000-000-0000 |
| validate-and-enter-email-ok | css=#premium_sms .email |              |

# Phone number validation
| type-ok                     | css=#premium_sms .email | %%email_address%% |
| validate-and-enter-phone-ok | css=#premium_sms .phone |                   |

| type-ok   | css=#premium_sms .email          | %%email_address%% |
| type-ok   | css=#premium_sms .phone          | 000-000-0000      |
| select-ok | css=#premium_sms .paymentPeriod  | $1.50 / Month     |
| click-ok  | css=.ui-dialog-buttonset .submit |                   |

# Redirect to PayPal
| wait-for-page-to-load-ok | 30000                                      |
| login-paypal-ok          |                                            |
| wait-for-text-present-ok | $1.50 per month for Recollect notifications |

#####################################################
| *comment* | CANCEL, go back and choose $15 / Year |

| open-reminder-lightbox-ok | vancouver-south-red                        |                   |
| click-ok                  | sms-reminder                               |                   |
| click-ok                  | css=.ui-dialog-buttonset .next             |                   |
| wait-for-text-present-ok  | Schedule a Text Message Reminder:          |                   |
| type-ok                   | css=#premium_sms .email                    | %%email_address%% |
| type-ok                   | css=#premium_sms .phone                    | 000-000-0000      |
| select-ok                 | css=#premium_sms .paymentPeriod            | $15.00 / Year     |
| click-ok                  | css=.ui-dialog-buttonset .submit           |                   |
| wait-for-page-to-load-ok  | 30000                                      |                   |
| login-paypal-ok           |                                            |                   |
| wait-for-text-present-ok  | $15.00 per year for Recollect notifications |                   |

| click-ok                 | continue                                                      |
| wait-for-text-present-ok | Thank you for subscribing to Recollect, %%email_address%%.     |
| is-text-present-ok       | You will soon receive a confirmation email and phone message. |

# Wait for the welcome email 
| reminder-success-email-ok | %%email_address%% | sms |

# Remove the reminder
| open-ok                  | %%delete_url%%                                   |
| click-ok                 | css=.button.yes                                  |
| wait-for-text-present-ok | The following garbage reminder has been deleted: |
| is-text-present-ok       | Zone:vancouver-south-red                         |
| is-text-present-ok       | Email:%%email_address%%                          |

##
# E-Mail Reminders
#

# Open the reminder lightbox
| open-reminder-lightbox-ok | vancouver-south-red |

# Choose email
| click-ok                 | email-reminder                 |
| click-ok                 | css=.ui-dialog-buttonset .next |
| wait-for-text-present-ok | Schedule an E-Mail Reminder:   |

# Email validation
| validate-and-enter-email-ok | css=#basic_email .email          | %%email_address%% |
| click_ok                    | css=.ui-dialog-buttonset .submit |                   |
| wait-for-text-present-ok    | Wait! You're not done yet!       |                   |

# Verify the confirmation email
| reminder-confirm-email-ok | %%email_address%% |

# Confirm the reminder
| open-ok                  | %%confirm_url%%                                        |
| wait-for-text-present-ok | Thank you for confirming your email, %%email_address%% |
| is-text-present-ok       | You will soon receive an email with all the details.   |

# Wait for the welcome email 
| reminder-success-email-ok | %%email_address%% | email |

# Remove the reminder
| open-ok                     | %%delete_url%%                                                                                   |
| wait-for-text-present-ok    | Are you sure you want to unsubscribe email:%%email_address%% from vancouver-south-red reminders? |
| click-ok                    | css=.button.no                                                                                   |
| wait-for-text-present-ok    | Recollect helps you manage your household garbage schedule more effectively.                  |
| open-ok                     | %%delete_url%%                                                                                   |
| wait-for-element-present-ok | css=.button.yes                                                                                  |
| click-ok                    | css=.button.yes                                                                                  |
| wait-for-text-present-ok    | The following garbage reminder has been deleted:                                                 |
| is-text-present-ok          | Zone:vancouver-south-red                                                                         |
| is-text-present-ok          | Email:%%email_address%%                                                                          |

##
# Twitter Reminders
#

# Open the reminder lightbox
| open-reminder-lightbox-ok | vancouver-south-red |

# Choose twitter
| click-ok                 | twitter-reminder               |
| click-ok                 | css=.ui-dialog-buttonset .next |
| wait-for-text-present-ok | Schedule a Twitter Reminder:   |

# Email validation
| type-ok                     | css=#basic_twitter .twitter      | kevinj            |
| validate-and-enter-email-ok | css=#basic_twitter .email        | %%email_address%% |
| click_ok                    | css=.ui-dialog-buttonset .submit |                   |
| wait-for-text-present-ok    | Wait! You're not done yet!       |                   |

# Verify the confirmation email
| reminder-confirm-email-ok | %%email_address%% |

# Confirm the reminder
| open-ok                  | %%confirm_url%%                                        |
| wait-for-text-present-ok | Thank you for confirming your email, %%email_address%% |
| is-text-present-ok       | You will soon receive an email with all the details.   |

# Wait for the welcome email 
| reminder-success-email-ok | %%email_address%% | twitter |

# Remove the reminder
| open-ok                     | %%delete_url%%                                                                          |
| wait-for-text-present-ok    | Are you sure you want to unsubscribe twitter:kevinj from vancouver-south-red reminders? |
| click-ok                    | css=.button.no                                                                          |
| wait-for-text-present-ok    | Recollect helps you manage your household garbage schedule more effectively.         |
| open-ok                     | %%delete_url%%                                                                          |
| wait-for-element-present-ok | css=.button.yes                                                                         |
| click-ok                    | css=.button.yes                                                                         |
| wait-for-text-present-ok    | The following garbage reminder has been deleted:                                        |
| is-text-present-ok          | Zone:vancouver-south-red                                                                |
| is-text-present-ok          | Email:%%email_address%%                                                                 |
